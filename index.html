<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Morada</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.tiny.cloud/1/5g985h5nnoarje29szp3x7g2z6a811y9wsvvp2wylg5s6u4i/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
  </head>
  <body>
    <div class="main-container">
      <div id="outliner-sidebar" class="hidden">
        <div class="outliner-header">
          <h3>Outline</h3>
        </div>
        <div id="outliner-list"></div>
      </div>
      <div class="content-area">
        <div class="breadcrumb-bar" id="breadcrumb-bar">
          <div style="display:flex;align-items:center;gap:8px;">
            <button id="breadcrumb-back-btn" title="Back">⟵ Back</button>
            <button id="open-navigator-btn" title="Open Navigator">Navigator</button>
            <button id="open-compendium-btn" title="Open Compendium">Compendium</button>
            <button id="open-scriptorium-btn" title="Open Scriptorium for selected node">Scriptorium</button>
            <button id="new-project-btn" title="Create a new Project on the main floor">New Project</button>
            <button id="auto-fit-toggle" title="Toggle auto-fit of nodes">Auto-Fit: On</button>
          </div>
          <div id="breadcrumb-path" style="margin-left:12px; font-weight:600;">The Grounds</div>
        </div>
        <h2 id="view-title"></h2>
        <button id="add-shelf-btn" class="hidden" title="Add a new shelf with a book">+</button>
        <canvas id="nest-canvas"></canvas>
      </div>
    </div>
    
    <div id="editor-mode" class="hidden">
        <div id="editor-main-content">
      <div id="editor-toolbar" class="editor-toolbar">
        <button id="editor-comment-btn" type="button" title="Add Comment (Ctrl+M)">Comment</button>
        <button id="editor-certify-btn" type="button" title="Certify Word (Ctrl+Shift+C)">Certify</button>
        <button id="editor-saveclose-btn" type="button" title="Save and Close (Esc)">Save & Close</button>
      </div>
            <textarea id="main-editor"></textarea>
        </div>
        <div id="editor-inspector-sidebar" class="hidden">
            <div id="editor-metadata">
                <div id="editor-status-bar">
                    <span id="editor-word-count">Words: 0</span>
                    <div id="writing-timer-controls">
                      <label for="timer-duration-input">Set Timer (min):</label>
                      <input type="number" id="timer-duration-input" value="30" min="1">
                      <button id="timer-start-btn">Start Timer</button>
                      <span id="writing-timer-display">Time: 00:00</span>
                    </div>
                    <div id="word-goal-controls">
                      <label for="word-goal-input">Word Goal:</label>
                      <span id="word-goal-current">0</span> / <input type="number" id="word-goal-input" value="500" min="0">
                    </div>
                </div>
                <div id="tag-manager">
                    <label>Tags:</label>
                    <div id="tag-list"></div>
                    <input type="text" id="tag-input" placeholder="Add a tag and press Enter...">
                </div>
            </div>
            <div id="editor-footnotes-pane">
                <h4 id="footnotes-header">Footnotes <span id="footnotes-toggle">▾</span></h4>
                <div id="footnotes-list-container">
                    <div id="footnotes-list"></div>
                </div>
            </div>
        </div>
        <div class="editor-instructions">Press 'Escape' to save and close</div>
    </div>
<!-- Comment Modal -->
<div id="comment-modal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Add/Edit Comment</h2>
            <span class="close-button" id="close-comment-modal">&times;</span>
        </div>
        <div class="modal-body">
            <p>Commenting on: "<span id="comment-selected-text"></span>"</p>
            <textarea id="comment-textarea" placeholder="Type your comment here..."></textarea>
        </div>
        <div class="modal-footer">
            <button id="save-comment-btn">Save Comment</button>
            <button id="delete-comment-btn" class="delete-button">Delete Comment</button>
        </div>
    </div>
</div>

    <div id="search-palette" class="hidden">
      <input type="text" id="search-input" placeholder="Search content or #tags...">
      <div id="search-results"></div>
    </div>

    <div id="compendium-modal" class="hidden">
      <div class="compendium-header">
        <h2>The Compendium</h2>
        <input type="text" id="compendium-filter" placeholder="Filter by text or #tag...">
        <button id="close-compendium-btn">×</button>
      </div>
      <div class="compendium-body">
          <div id="compendium-library" class="compendium-panel">
            </div>
          <div id="compendium-manuscript" class="compendium-panel">
            </div>
      </div>
      <div class="compendium-footer">
        <div class="compendium-options">
          <label for="include-comments-checkbox"><input type="checkbox" id="include-comments-checkbox"> Include Comments as Footnotes</label>
          <label for="include-certified-words-checkbox"><input type="checkbox" id="include-certified-words-checkbox"> Include Certified Words as Footnotes</label>
        </div>
        <button id="generate-btn">Generate .txt File</button>
        <button id="export-tags-btn" title="Export all tags as CSV">Export Tags</button>
      </div>
    </div>

    <div id="etymology-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="etymology-word">Etymology</h3>
          <span class="close-button" id="close-etymology-btn">&times;</span>
        </div>
        <div id="etymology-result-area" class="modal-body">
          <p>Loading...</p>
        </div>
      </div>
    </div>

    <div id="certify-word-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Certify Word: "<span id="certify-selected-word"></span>"</h3>
          <span class="close-button" id="close-certify-word-btn">&times;</span>
        </div>
        <div class="modal-body">
          <label for="certify-definition-input">Your Definition:</label>
          <textarea id="certify-definition-input" rows="4"></textarea>
        </div>
        <div class="modal-footer">
          <button id="save-certification-btn">Save Definition</button>
          <button id="cancel-certification-btn">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Hover Tooltip for Comments & Certified Words -->
    <div id="hover-tooltip" class="hidden"></div>

    <!-- Context Menu for Canvas Nodes -->
    <div id="canvas-context-menu" class="context-menu hidden">
      <ul>
        <li id="rename-node-option">Rename</li>
      </ul>
    </div>

    <!-- Load core non-module scripts that expose globals the renderer expects. -->
    <script src="js/constants.js"></script>
    <script src="js/dataStorage.js"></script>
    <script src="js/stateManager.js"></script>
    <script src="js/canvasRenderer.js"></script>
    <script src="js/nodeManager.js"></script>
    <script src="js/editorManager.js"></script>
    <script src="js/uiManager.js"></script>

    <!-- Load the main renderer script as a module. It relies on the globals above. -->
    <script type="module" src="js/renderer.js"></script>
  </body>
</html>
